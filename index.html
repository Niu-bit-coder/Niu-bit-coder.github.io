<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>日语学习打卡系统</title>
    <!-- 你的CSS样式 -->
</head>
<body>
    <div class="container">
        <h1>JLPT N2 学习系统</h1>
        
        <!-- API密钥设置区域 - 更明显的版本 -->
        <div style="background: #fffacd; border: 3px solid #ffd700; padding: 20px; margin: 20px 0; border-radius: 10px;">
            <h2 style="color: #ff6b6b;">⚠️ 首次使用必须设置</h2>
            <label for="apiKeyInput" style="font-size: 16px; font-weight: bold;">请输入您的Gemini API密钥：</label>
            <input type="password" id="apiKeyInput" placeholder="粘贴您的API密钥..." style="width: 100%; padding: 15px; font-size: 14px; border: 2px solid #ff6b6b; margin: 10px 0;">
            <button onclick="saveApiKey()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px;">保存API密钥</button>
            <p style="color: #666; font-size: 14px;">密钥将保存在您的浏览器本地，仅您可见</p>
        </div>

        <!-- AI助手区域 -->
        <div class="ai-chat">
            <h2>AI助手</h2>
            <input type="text" id="chatInput" placeholder="输入日语学习问题..." style="width: 100%; padding: 10px;">
            <button onclick="askAI()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px;">提问</button>
            <div id="chatResponse" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                请先设置API密钥，然后就可以提问了
            </div>
        </div>

        <!-- 你的其他功能区域 -->
    </div>

    <script>
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('请输入API密钥');
                return;
            }
            
            localStorage.setItem('gemini_api_key', apiKey);
            document.getElementById('apiKeyInput').style.display = 'none';
            document.querySelector('[onclick="saveApiKey()"]').style.display = 'none';
            document.getElementById('chatResponse').innerHTML = 'API密钥已保存！现在可以开始提问了';
            alert('API密钥保存成功！');
        }

        async function askAI() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!apiKey) {
                alert('请先设置API密钥');
                return;
            }

            const question = document.getElementById('chatInput').value;
            if (!question.trim()) {
                alert('请输入问题');
                return;
            }

            const responseDiv = document.getElementById('chatResponse');
            responseDiv.innerHTML = 'AI思考中...';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `你是日语学习助手，请回答：${question}`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                if (data.candidates && data.candidates[0]) {
                    responseDiv.innerHTML = data.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                } else {
                    responseDiv.innerHTML = 'API调用失败，请检查密钥';
                }
            } catch (error) {
                responseDiv.innerHTML = '网络错误：' + error.message;
            }

            document.getElementById('chatInput').value = '';
        }

        // 页面加载时检查是否已有密钥
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('gemini_api_key')) {
                document.getElementById('apiKeyInput').style.display = 'none';
                document.querySelector('[onclick="saveApiKey()"]').style.display = 'none';
                document.getElementById('chatResponse').innerHTML = 'API密钥已设置，可以开始提问！';
            }
        });
    </script>
</body>
</html>
